# Инструкция по переходу на новую схему БД

## Что изменилось

Проект полностью переведен на новую схему БД с разделением на:
- **Астральную часть** (справочники: типы, варианты, узлы, ревизии)
- **Материальную часть** (реальные узлы с серийными номерами, операции, склады)

## Структура новой БД

### Астральная часть (Справочники)

1. **AstralType** - Типы устройств (маршрутизаторы, коммутаторы, серверы)
2. **AstralVariant** - Варианты исполнения устройств
3. **AstralPart** - Узлы устройств (базовые или уникальные)
4. **AstralRevision** - Версии (ревизии) узлов
5. **AstralYear** - Привязка варианта к году выпуска
6. **AstralManufacturer** - Производители устройств

### Материальная часть (Рабочие данные)

1. **MaterialPart** - Реальные узлы с серийными номерами
2. **MaterialOperations** - Журнал операций
3. **MaterialGroup** - Группы операций
4. **MaterialOperationType** - Типы операций
5. **MaterialUser** - Пользователи системы
6. **MaterialStatus** - Статусы операций
7. **MaterialWarehouse** - Склады (с древовидной структурой)

## Порядок заполнения БД

### 1. Заполнение астральной части (через Django Admin)

```
http://127.0.0.1:8000/admin/
```

**Порядок заполнения:**

1. **AstralType** (Типы устройств)
   - Пример: Маршрутизатор, Коммутатор, Сервер

2. **AstralVariant** (Варианты исполнения)
   - Выбираете AstralType
   - Указываете название и код варианта

3. **AstralYear** (Годы выпуска)
   - Привязываете AstralVariant к году

4. **AstralManufacturer** (Производители)
   - Привязываете к AstralYear
   - Указываете название и код производителя

5. **AstralPart** (Узлы)
   - Привязываете к AstralVariant
   - Указываете название и код узла

6. **AstralRevision** (Ревизии)
   - Привязываете к AstralPart
   - Можно указать родительскую ревизию
   - Можно загрузить изображение

### 2. Заполнение материальной части

**Через Django Admin:**

1. **MaterialGroup** (Группы операций)
   - Пример: Сборка, Ремонт, Хранение

2. **MaterialOperationType** (Типы операций)
   - Привязываете к MaterialGroup

3. **MaterialStatus** (Статусы)
   - Пример: В работе, Завершено, Отменено

4. **MaterialWarehouse** (Склады)
   - Можно создать иерархию складов

5. **MaterialUser** (Пользователи)
   - Привязываете к MaterialGroup

**Через веб-интерфейс:**

- **MaterialPart** - создание через `/material-parts/create/`
- **MaterialOperations** - создание через `/operations/create/`

## Новые URL-адреса

### Материальные узлы
- Список: `/material-parts/`
- Детали: `/material-parts/<id>/`
- Создание: `/material-parts/create/`
- Редактирование: `/material-parts/<id>/edit/`
- Удаление: `/material-parts/<id>/delete/`

### Операции (Журнал)
- Список: `/operations/`
- Детали: `/operations/<id>/`
- Создание: `/operations/create/`
- Редактирование: `/operations/<id>/edit/`
- Удаление: `/operations/<id>/delete/`

### Астральные ревизии
- Список: `/astral-revisions/`
- Детали: `/astral-revisions/<id>/`
- Создание: `/astral-revisions/create/`
- Редактирование: `/astral-revisions/<id>/edit/`
- Удаление: `/astral-revisions/<id>/delete/`

### Астральные узлы
- Список: `/astral-parts/`
- Детали: `/astral-parts/<id>/`

## Пример заполнения

### Шаг 1: Создаем тип устройства
```
Название: Маршрутизатор
Код: ROUTER
Описание: Сетевое оборудование для маршрутизации трафика
```

### Шаг 2: Создаем вариант
```
Название: Базовый маршрутизатор
Код: ROUTER-BASE
Тип: Маршрутизатор
```

### Шаг 3: Создаем год выпуска
```
Вариант: Базовый маршрутизатор
Год: 2024
```

### Шаг 4: Создаем производителя
```
Название: ООО "Производитель"
Код: MANUF-001
Год выпуска: Базовый маршрутизатор - 2024
```

### Шаг 5: Создаем узел
```
Название: Плата процессора
Код: CPU-BOARD-001
Вариант: Базовый маршрутизатор
```

### Шаг 6: Создаем ревизию
```
Название: Ревизия 1.0
Узел: Плата процессора
Дата выпуска: 01.01.2024
```

### Шаг 7: Создаем материальный узел
```
Серийный номер: SN-001-2024
Ревизия: Ревизия 1.0
Год: 2024
Производитель: ООО "Производитель"
```

## Запуск сервера

```bash
python manage.py runserver
```

Админ панель: http://127.0.0.1:8000/admin/
Главная страница: http://127.0.0.1:8000/

## Создание суперпользователя

```bash
python manage.py createsuperuser
```

## Docker

Для запуска в Docker:

```bash
docker-compose up -d --build
docker-compose exec web python manage.py migrate
docker-compose exec web python manage.py createsuperuser
```

## Примечания

- Все старые модели (Device, Part, Journal и т.д.) удалены
- QR-коды теперь генерируются для MaterialPart и AstralRevision
- Изображения хранятся в БД как BinaryField
- Связи между таблицами используют PROTECT для предотвращения случайного удаления

